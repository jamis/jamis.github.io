(function(){var a,c,b;b=(function(){d.prototype.N=624;d.prototype.M=397;d.prototype.MATRIX_A=2567483615;d.prototype.UPPER_MASK=2147483648;d.prototype.LOWER_MASK=2147483647;function d(e){this.mt=new Array(this.N);this.setSeed(e)}d.prototype.unsigned32=function(e){if(e<0){return(e^this.UPPER_MASK)+this.UPPER_MASK}else{return e}};d.prototype.subtraction32=function(f,e){if(f<e){return this.unsigned32((4294967296-(e-f))%4294967295)}else{return f-e}};d.prototype.addition32=function(f,e){return this.unsigned32((f+e)&4294967295)};d.prototype.multiplication32=function(h,f){var e,g,j;g=0;for(e=j=0;j<32;e=++j){if((h>>>e)&1){g=this.addition32(g,this.unsigned32(f<<e))}}return g};d.prototype.setSeed=function(e){if(!e||typeof e==="number"){return this.seedWithInteger(e)}else{return this.seedWithArray(e)}};d.prototype.defaultSeed=function(){var e;e=new Date();return e.getMinutes()*60000+e.getSeconds()*1000+e.getMilliseconds()};d.prototype.seedWithInteger=function(f){var e;this.seed=f!=null?f:this.defaultSeed();this.mt[0]=this.unsigned32(this.seed&4294967295);this.mti=1;e=[];while(this.mti<this.N){this.mt[this.mti]=this.addition32(this.multiplication32(1812433253,this.unsigned32(this.mt[this.mti-1]^(this.mt[this.mti-1]>>>30))),this.mti);this.mti[this.mti]=this.unsigned32(this.mt[this.mti]&4294967295);e.push(this.mti++)}return e};d.prototype.seedWithArray=function(l){var h,g,e,f;this.seedWithInteger(19650218);h=1;g=0;e=this.N>l.length?this.N:l.length;while(e>0){f=this.multiplication32(this.unsigned32(this.mt[h-1]^(this.mt[h-1]>>>30)),1664525);this.mt[h]=this.addition32(this.addition32(this.unsigned32(this.mt[h]^f),l[g]),g);this.mt[h]=this.unsigned32(this.mt[h]&4294967295);h++;g++;if(h>=this.N){this.mt[0]=this.mt[this.N-1];h=1}if(g>=l.length){g=0}e--}e=this.N-1;while(e>0){this.mt[h]=this.subtraction32(this.unsigned32(this.mt[h]^this.multiplication32(this.unsigned32(this.mt[h-1]^(this.mt[h-1]>>>30)),1566083941)),h);this.mt[h]=this.unsigned32(this.mt[h]&4294967295);h++;if(h>=this.N){this.mt[0]=this.mt[this.N-1];h=1}}return this.mt[0]=2147483648};d.prototype.nextInteger=function(e){var f,g,h;if((e!=null?e:1)<1){return 0}g=[0,this.MATRIX_A];if(this.mti>=this.N){f=0;while(f<this.N-this.M){h=this.unsigned32((this.mt[f]&this.UPPER_MASK)|(this.mt[f+1]&this.LOWER_MASK));this.mt[f]=this.unsigned32(this.mt[f+this.M]^(h>>>1)^g[h&1]);f++}while(f<this.N-1){h=this.unsigned32((this.mt[f]&this.UPPER_MASK)|(this.mt[f+1]&this.LOWER_MASK));this.mt[f]=this.unsigned32(this.mt[f+this.M-this.N]^(h>>>1)^g[h&1]);f++}h=this.unsigned32((this.mt[this.N-1]&this.UPPER_MASK)|(this.mt[0]&this.LOWER_MASK));this.mt[this.N-1]=this.unsigned32(this.mt[this.M-1]^(h>>>1)^g[h&1]);this.mti=0}h=this.mt[this.mti++];h=this.unsigned32(h^(h>>>11));h=this.unsigned32(h^((h<<7)&2636928640));h=this.unsigned32(h^((h<<15)&4022730752));return this.unsigned32(h^(h>>>18))%(e!=null?e:4294967296)};d.prototype.nextFloat=function(){return this.nextInteger()/4294967295};d.prototype.nextBoolean=function(){return this.nextInteger()%2===0};return d})();c=(function(){d.prototype.N=1<<0;d.prototype.S=1<<1;d.prototype.E=1<<2;d.prototype.W=1<<3;function d(h,f,g){var e,i;this.width=h;this.height=f;if(g==null){g={}}this.grid=(function(){var l,k,j;j=[];for(i=l=1,k=this.height;1<=k?l<=k:l>=k;i=1<=k?++l:--l){j.push((function(){var o,m,n;n=[];for(e=o=1,m=this.width;1<=m?o<=m:o>=m;e=1<=m?++o:--o){n.push(0)}return n}).call(this))}return j}).call(this);this.rand=new b(g.seed);this.rand.randomElement=function(j){return j[this.nextInteger(j.length)]};this.rand.shuffleList=function(n){var l,k,m;l=n.length-1;while(l>0){k=this.nextInteger(l+1);m=[n[k],n[l]],n[l]=m[0],n[k]=m[1];l--}return n};this.generate()}d.prototype.mark=function(g,f,e){return this.grid[f][g]|=e};d.prototype.unmark=function(g,f,e){return this.grid[f][g]&=~e};d.prototype.isMarked=function(e,g,f){return(this.grid[f][g]&e)===e};d.prototype.utilities=function(){var e;return e={dx:(function(f){return function(g){switch(g){case f.N:case f.S:return 0;case f.E:return 1;case f.W:return -1}}})(this),dy:(function(f){return function(g){switch(g){case f.E:case f.W:return 0;case f.N:return -1;case f.S:return 1}}})(this),opposite:(function(f){return function(g){switch(g){case f.W:return f.E;case f.E:return f.W;case f.N:return f.S;case f.S:return f.N}}})(this),directions:[this.N,this.S,this.E,this.W]}};d.prototype.generate=function(){var u,s,q,p,r,l,w,v,t,k,o,m,h,z,n,j,i,g,e,f;n=this.utilities(),q=n.dx,p=n.dy,t=n.opposite,s=n.directions;k=[[this.rand.nextInteger(this.width),this.rand.nextInteger(this.height)]];f=[];while(k.length>0){l=this.rand.nextBoolean()?this.rand.nextInteger(k.length):k.length-1;j=k[l],o=j[0],m=j[1];r=false;i=this.rand.shuffleList(s.slice(0));for(h=0,z=i.length;h<z;h++){u=i[h];g=[o+q(u),m+p(u)],w=g[0],v=g[1];if((0<=w&&w<this.width)&&(0<=v&&v<this.height)&&this.grid[v][w]===0){r=true;this.grid[m][o]|=u;this.grid[v][w]|=t(u);k.push([w,v]);break}}if(!r){f.push(([].splice.apply(k,[l,l-l+1].concat(e=[])),e))}else{f.push(void 0)}}return f};d.prototype.thin=function(m){var q,e,n,s,r,l,j,k,p,o,h,i,g,f;i=this.utilities(),s=i.dx,r=i.dy,k=i.opposite,n=i.directions;f=[];for(o=h=0,g=this.height-1;0<=g?h<=g:h>=g;o=0<=g?++h:--h){f.push((function(){var u,v,t;t=[];for(p=u=0,v=this.width-1;0<=v?u<=v:u>=v;p=0<=v?++u:--u){q=this.grid[o][p];if(q===this.N||q===this.S||q===this.E||q===this.W){if(this.rand.nextInteger(100)<m){t.push((function(){var y,w,A,z,x;A=this.rand.shuffleList(n.slice(0));x=[];for(y=0,w=A.length;y<w;y++){e=A[y];if(q===e){continue}z=[p+s(e),o+r(e)],l=z[0],j=z[1];if((0<=l&&l<this.width)&&(0<=j&&j<this.height)){this.grid[o][p]|=e;this.grid[j][l]|=k(e);break}else{x.push(void 0)}}return x}).call(this))}else{t.push(void 0)}}else{t.push(void 0)}}return t}).call(this))}return f};d.prototype.findDistances=function(v,u){var w,s,j,k,r,q,l,m,B,e,A,z,t,p,o,g,f,C,D,n,i,h;n=this.utilities(),r=n.dx,q=n.dy,t=n.opposite,s=n.directions;m=[[v,u]];k=(function(){var E,x,y;y=[];for(o=E=1,x=this.height;1<=x?E<=x:E>=x;o=1<=x?++E:--E){y.push((function(){var G,H,F;F=[];for(p=G=1,H=this.width;1<=H?G<=H:G>=H;p=1<=H?++G:--G){F.push(void 0)}return F}).call(this))}return y}).call(this);k[u][v]=0;B=0;l=null;while(m.length>0){e=[];for(g=0,C=m.length;g<C;g++){i=m[g],p=i[0],o=i[1];j=k[o][p];for(f=0,D=s.length;f<D;f++){w=s[f];if(this.isMarked(w,p,o)){h=[p+r(w),o+q(w)],A=h[0],z=h[1];if(k[z][A]==null){if(j+1>B){B=j+1;l=[A,z]}k[z][A]=j+1;e.push([A,z])}}}}m=e}return[k,B,l]};d.prototype.findLongestPath=function(){var l,n,m,k,j,i,h,g,f,e;h=this.findDistances(0,0),l=h[0],k=h[1],(g=h[2],j=g[0],i=g[1]);f=this.findDistances(j,i),l=f[0],k=f[1],(e=f[2],n=e[0],m=e[1]);return[k,j,i,n,m]};return d})();a=(function(){var e;e=(function(){function f(g){this.children=[];this.depth=g!=null?g:1}return f})();d.prototype.DisplayMaze=1;d.prototype.DisplayTree=2;function d(h,g,f){this.width=g;this.height=f;this.canvas=document.getElementById(h);this.canvas.onclick=(function(i){return function(j){return i.clicked(j)}})(this);this.reset()}d.prototype.clicked=function(h){var g,f,j,i;if(this.startTime!=null){return}if(h.offsetX!=null){j=h.offsetX;i=h.offsetY}else{j=h.pageX-this.canvas.offsetLeft;i=h.pageY-this.canvas.offsetTop}f=null;g=1000000;this.eachNode((function(k){return function(l){var m;m=Math.abs(l.position.x-j)+Math.abs(l.position.y-i);if(m<g){g=m;return f=l}}})(this));if(this.mode===this.DisplayMaze){if(this.selection===f){this.buildTree(f.coords.x,f.coords.y)}else{this.selection=f}}else{this.selection=f}return this.render()};d.prototype.reset=function(){var f,h,g;this.startTime=null;this.mode=this.DisplayTree;this.maze=new c(this.width,this.height);g=[this.maze.rand.nextInteger(this.maze.width),this.maze.rand.nextInteger(this.maze.height)],f=g[0],h=g[1];return this.buildTree(f,h)};d.prototype.buildTree=function(C,B){var I,k,l,q,n,m,h,g,f,E,M,L,A,z,F,i,s,j,H,D,G,Q,P,O,N,w,J,v,u,t,r,p,o,K;J=this.maze.utilities(),g=J.dx,f=J.dy,A=J.opposite,m=J.directions;F=32768;for(G=P=0,v=this.maze.height-1;0<=v?P<=v:P>=v;G=0<=v?++P:--P){for(H=O=0,u=this.maze.width-1;0<=u?O<=u:O>=u;H=0<=u?++O:--O){this.maze.unmark(H,G,F)}}this.selection=this.root=new e;h=this.cellWidth=this.canvas.width/this.maze.width;q=this.cellHeight=this.canvas.height/this.maze.height;D=Math.floor(h/2);Q=Math.floor(q/2);this.root.coords={x:C,y:B};this.root.position={x:Math.round(D+C*h),y:Math.round(Q+B*q)};this.root.start={x:this.root.position.x,y:this.root.position.y};z=[this.root];j={};this.deepest=0;s=0;while(z.length>0){E=z.pop();this.maze.mark(E.coords.x,E.coords.y,F);if(this.deepest<E.depth){this.deepest=E.depth}j[E.depth]=((t=j[E.depth])!=null?t:0)+1;if(s<j[E.depth]){s=j[E.depth]}r=[this.maze.E,this.maze.N,this.maze.S,this.maze.W];for(N=0,w=r.length;N<w;N++){n=r[N];if(this.maze.isMarked(n,E.coords.x,E.coords.y)){p=[E.coords.x+g(n),E.coords.y+f(n)],M=p[0],L=p[1];if(!this.maze.isMarked(F,M,L)){k=new e(E.depth+1);k.coords={x:M,y:L};k.position={x:Math.round(D+M*h),y:Math.round(Q+L*q)};k.start={x:k.position.x,y:k.position.y};E.children.push(k);z.push(k)}}}}q=this.canvas.height/this.deepest;Q=Math.floor(q/2);i={};z=[this.root];K=[];while(z.length>0){E=z.pop();l=E.depth-1;I=(o=i[E.depth])!=null?o:0;i[E.depth]=I+1;h=this.canvas.width/j[E.depth];D=Math.floor(h/2);E.target={x:Math.round(D+I*h),y:this.canvas.height-Math.round(Q+l*q)};if(this.mode===this.DisplayTree){E.position.x=E.target.x;E.position.y=E.target.y}K.push((function(){var R,x,S,y;S=E.children;y=[];for(R=0,x=S.length;R<x;R++){k=S[R];y.push(z.push(k))}return y})())}return K};d.prototype.animate=function(f){if(this.startTime!=null){return}this.startTime=Date.now();return this.update(f)};d.prototype.setMode=function(f){if(f===this.mode){return}this.mode=f;return this.eachNode((function(g){return function(h){if(g.mode===g.DisplayMaze){h.position.x=h.start.x;return h.position.y=h.start.y}else{if(g.mode===g.DisplayTree){h.position.x=h.target.x;return h.position.y=h.target.y}}}})(this))};d.prototype.eachNode=function(h){var j,i,f,g;f=[this.root];g=[];while(f.length>0){i=f.pop();h(i);g.push((function(){var n,k,m,l;m=i.children;l=[];for(n=0,k=m.length;n<k;n++){j=m[n];l.push(f.push(j))}return l})())}return g};d.prototype.step=function(){if(this.n==null){this.n=0}if(this.delta==null){this.delta=1}this.computeAt(this.n);this.n+=this.delta*0.05;if(this.n>1){this.n=1}else{if(this.n<0){this.n=0}}if(this.n>=1||this.n<=0){return this.delta*=-1}};d.prototype.update=function(h){var f,g;g=(Date.now()-this.startTime)/h;if(g>=1){g=1;f=true}else{f=false;g=-(Math.cos(Math.PI*g)-1)/2}this.computeAt(g);if(f){if(this.mode===this.DisplayMaze){this.mode=this.DisplayTree}else{this.mode=this.DisplayMaze}return this.startTime=null}else{return window.setTimeout(((function(i){return function(){return i.update(h)}})(this)),10)}};d.prototype.computeAt=function(o){var g,i,h,m,f,l,j,n,k;m=[this.root];h=this.root.children[0];while(m.length>0){i=m.pop();if(this.mode===this.DisplayMaze){f=i.start;l=i.target}else{f=i.target;l=i.start}if(o>=1){i.position.x=l.x;i.position.y=l.y}else{i.position.x=Math.round(f.x+o*(l.x-f.x));i.position.y=Math.round(f.y+o*(l.y-f.y))}k=i.children;for(j=0,n=k.length;j<n;j++){g=k[j];m.push(g)}}return this.render()};d.prototype.render=function(){var f;this.canvas.width=this.canvas.width;f=this.canvas.getContext("2d");f.beginPath();return this.eachNode((function(g){return function(j){var m,h,l,i,k;k=j.children;for(l=0,i=k.length;l<i;l++){m=k[l];f.beginPath();f.moveTo(j.position.x,j.position.y);f.lineTo(m.position.x,m.position.y);f.strokeStyle="#000";f.stroke()}if(j===g.root){f.fillStyle="#ff0000";f.fillRect(j.position.x-5,j.position.y-5,10,10)}if(j===g.selection){f.strokeStyle="7f0000";f.beginPath();f.rect(j.position.x-6,j.position.y-6,12,12);f.stroke()}if(j!==g.root){h=Math.floor(255*(g.deepest-j.depth)/g.deepest);f.fillStyle="rgb("+h+", 0, 0)";return f.fillRect(j.position.x-3,j.position.y-3,6,6)}}})(this))};return d})();window.generateTree=function(g,f){var e,d;e=document.getElementById(g);d=new a(g,f,f);d.render();return e.tree=d};window.resetTree=function(g){var e,f,d;e=document.getElementById(g);if((f=e.tree)!=null){f.reset()}return(d=e.tree)!=null?d.render():void 0};window.animateTree=function(g,f){var d,e;d=document.getElementById(g);return(e=d.tree)!=null?e.animate(f):void 0};window.stepTree=function(f){var d,e;d=document.getElementById(f);return(e=d.tree)!=null?e.step():void 0}}).call(this);